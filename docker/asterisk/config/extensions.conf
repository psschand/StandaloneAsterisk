[general]
static=yes
writeprotect=no
clearglobalvars=no

[default]
exten => s,1,NoOp(Default context)
 same => n,Hangup()

[from-twilio]
; Route the Twilio DID to extension 100 (Zoiper)
exten => +19863334949,1,NoOp(Inbound Twilio call for ${EXTEN})
 same => n,Goto(internal,100,1)

; Fallback: match 10-digit version of the DID
exten => 9863334949,1,NoOp(Inbound Twilio 10-digit match ${EXTEN})
 same => n,Goto(internal,100,1)

; Catch-all to avoid call loops
exten => _X.,1,NoOp(Unhandled Twilio DID ${EXTEN})
 same => n,Playback(silence/1&invalid)
 same => n,Hangup()

[outbound]
; Dial out via Twilio SIP trunk
; Use prefix 9 to dial external numbers: dial 9 + phone number
; OR dial +1XXXXXXXXXX directly for E.164 format
; Examples: 
;   915551234567 calls +15551234567 (adds + prefix for E.164)
;   9+15551234567 calls +15551234567 (handles + in dial string)
;   +15551234567 calls +15551234567 (direct E.164 dialing)

; Pattern for 9-prefix dialing
exten => _9.,1,NoOp(Outbound via Twilio: ${EXTEN})
 same => n,Set(NUM=${EXTEN:1})
 same => n,GotoIf($["${NUM:0:1}" = "+"]?dial:add_plus)
 same => n(add_plus),Set(NUM=+${NUM})
 same => n(dial),Set(CALLERID(num)=+19863334949)
 same => n,Set(CALLERID(name)=CallCenter)
 same => n,NoOp(Dialing ${NUM} from ${CALLERID(num)})
 same => n,Dial(PJSIP/${NUM}@twilio_trunk,30)
 same => n,Hangup()

; Pattern for direct E.164 dialing (+1XXXXXXXXXX)
exten => _+1XXXXXXXXXX,1,NoOp(Direct E.164 Outbound: ${EXTEN})
 same => n,Set(CALLERID(num)=+19863334949)
 same => n,Set(CALLERID(name)=CallCenter)
 same => n,NoOp(Dialing ${EXTEN} from ${CALLERID(num)})
 same => n,Dial(PJSIP/${EXTEN}@twilio_trunk,30)
 same => n,Hangup()

[internal]
; Internal softphone dialing
exten => 100,1,NoOp(Ringing extension 100)
 same => n,Dial(PJSIP/100,20)
 same => n,Hangup()

; Example: enable extension 101 if configured in pjsip.conf
exten => 101,1,NoOp(Ringing extension 101)
 same => n,Dial(PJSIP/101,20)
 same => n,Hangup()

include => outbound

[from-internal]
; Context alias for wizard-configured endpoints
include => internal
