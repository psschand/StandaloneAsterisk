; Static PJSIP configuration (rendered from templates in image)
; This file was created to ensure the container starts with a known config.

[global]
type=global
user_agent=Asterisk-Twilio-Docker

[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0
external_signaling_address=138.2.68.107
external_media_address=138.2.68.107
allow_reload=yes

; Simple PSTN test context for direct mapping of the test DID
[from-pstn]
; Directly route the test DID to extension 233 for testing
exten => +19863334949,1,NoOp(Incoming PSTN test DID to 101 and 100)
 same => n,Answer()
 same => n,Dial(PJSIP/100&PJSIP/101,30,tT)
 same => n,Hangup()

; Twilio trunk (credential based by default)
[twilio_trunk]
type=aor
contact=sip:nlpbay.pstn.ashburn.twilio.com:5060
qualify_frequency=60

[twilio_trunk]
type=endpoint
transport=transport-udp
context=from-twilio
disallow=all
allow=ulaw,alaw
aors=twilio_trunk
outbound_auth=twilio_auth
from_domain=nlpbay.pstn.ashburn.twilio.com
from_user=+19863334949
rewrite_contact=yes
force_rport=yes
rtp_symmetric=yes
direct_media=no
dtmf_mode=rfc4733

; Extension 101 (Zoiper second softphone)
[101]
type=aor
max_contacts=3
remove_existing=yes

[101-auth]
type=auth
auth_type=userpass
username=101
password=changeme101

[101]
type=endpoint
transport=transport-udp
context=internal
disallow=all
allow=ulaw,alaw
auth=101-auth
aors=101
callerid="Agent 101 <101>"
force_rport=yes
rtp_symmetric=yes
rewrite_contact=yes
dtmf_mode=rfc4733
t38_udptl=no

[twilio_trunk-identify]
type=identify
endpoint=twilio_trunk
# Twilio POP IPs - add any additional Twilio signaling IPs you expect
match=138.2.68.107
match=54.172.60.1
match=54.172.60.2
match=54.172.60.3

[twilio_auth]
type=auth
auth_type=userpass
username=Admin
password=Admin@1234567

; Extension 100 (Zoiper)
[100]
type=aor
max_contacts=3
remove_existing=yes

[100-auth]
type=auth
auth_type=userpass
username=100
password=changeme100

[100]
type=endpoint
transport=transport-udp
context=internal
disallow=all
allow=ulaw,alaw
auth=100-auth
aors=100
callerid="Agent 100 <9863334949>"
force_rport=yes
rtp_symmetric=yes
rewrite_contact=yes
dtmf_mode=rfc4733
